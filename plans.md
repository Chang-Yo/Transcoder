# 🎬 Editing Transcoder

**基于 Tauri + ffmpeg 的剪辑友好型转码工具**

---

## 1. 项目背景（Background）

在视频剪辑流程中，常见的视频来源（如网络下载、录屏、相机素材）通常采用 **H.264 / H.265（Long GOP）+ MKV/MP4 + 压缩音频** 的组合。这类格式虽然适合存储和播放，但在 **Premiere Pro（PR）和 After Effects（AE）** 中存在以下问题：

* 时间线拖动卡顿
* 加效果、调色时实时性能差
* AE RAM Preview 不稳定
* 音频编码（如 FLAC）不被 Adobe 原生支持
* 10-bit 素材在剪辑软件中兼容性不可预测

专业后期工作流通常通过 **“中间编码（Intermediate Codec）”** 解决上述问题，但现有 GUI 工具（如 HandBrake、格式工厂）主要面向“播放与压缩”，而非“剪辑稳定性”。

---

## 2. 项目目标（Goals）

### 2.1 核心目标

构建一个**面向剪辑场景的本地转码工具**，将任意常见视频素材**稳定地转换为 PR / AE 友好的中间格式**。

> 本项目的目标不是“万能转码器”，而是：
>
> **“让素材在剪辑软件中表现稳定、流畅、可预测。”**

---

### 2.2 非目标（Explicit Non-Goals）

* 不追求支持大量输出格式
* 不提供复杂的编码参数手动配置
* 不作为视频压缩 / 发布工具
* 不替代 ffmpeg 本身

---

## 3. 目标用户（Target User）

* 需要在 **Premiere Pro / After Effects** 中剪辑视频的个人用户
* 熟悉或愿意使用本地工具的技术向用户
* 对剪辑稳定性、时间线流畅度有明确需求的人

---

## 4. 核心设计理念（Design Principles）

1. **意图驱动，而非参数驱动**
   用户选择“我要剪辑”，而不是“我要设置编码参数”。

2. **预设即策略**
   所有 ffmpeg 参数都由程序内部控制，确保结果一致性。

3. **剪辑稳定性优先于文件体积**
   输出文件可大，但必须稳定。

4. **最小功能集（Minimal Viable Tool）**
   功能少，但每一个都有明确价值。

---

## 5. 功能范围（Scope）

### 5.1 输入支持

* 常见容器：MKV / MP4 / AVI / MOV
* 常见视频编码：H.264 / H.265 / VP9 / AV1（只要 ffmpeg 支持）
* 常见音频编码：AAC / FLAC / MP3 / Opus

### 5.2 媒体信息解析

使用 `ffprobe` 自动解析以下信息：

* 分辨率
* 帧率（精确保留，如 23.976）
* 视频位深（8-bit / 10-bit）
* 色度采样
* 音频编码与采样率

---

## 6. 输出设计（最重要部分）

### 6.1 视频输出预设（固定）

#### 预设 1：ProRes 422（推荐）

* 用途：主剪辑格式
* 特点：

  * 帧内压缩
  * 10-bit
  * 4:2:2 色度采样
  * PR / AE 原生支持

#### 预设 2：ProRes 422 LT

* 用途：磁盘空间受限时
* 特点：

  * 相比 422 减小体积
  * 剪辑性能仍然稳定

#### 预设 3：DNxHR HQX（Windows 友好）

* 用途：替代 ProRes 的中间格式
* 特点：

  * Adobe 全面支持
  * 10-bit / 4:2:2

---

### 6.2 音频输出策略（自动）

* 所有输入音频 → **PCM（无压缩）**
* 默认：PCM 16-bit
* 可选：PCM 24-bit

理由：

* Adobe 全线原生支持
* 避免音频解码和兼容性问题

---

### 6.3 智能规则（Implicit Logic）

程序自动处理以下逻辑，**不暴露给用户**：

* 输入为 10-bit → 输出保持 10-bit
* 输入帧率 → 原样保留（不自动转换）
* 输入音频为 FLAC / Opus → 自动转 PCM
* 不进行分辨率缩放（除非未来版本明确支持）

---

## 7. 用户界面（UI）设计原则

### 7.1 界面目标

* 一眼能懂
* 无专业术语负担
* 不需要理解编码知识

### 7.2 最小 UI 结构（v1）

```
[ 拖拽或选择视频文件 ]

输出格式：
(●) ProRes 422（推荐）
( ) ProRes 422 LT（省空间）
( ) DNxHR HQX（Windows）

输出目录：[ 选择路径 ]

[ 开始转码 ]
```

---

## 8. 技术架构（Architecture）

### 8.1 技术栈

* **Frontend**：TypeScript + Web UI（Tauri）
* **Backend**：Rust（Tauri Command）
* **媒体处理**：系统级 ffmpeg + ffprobe

---

### 8.2 后端职责（Rust）

* 校验 ffmpeg / ffprobe 是否存在
* 调用 ffprobe 获取媒体信息
* 根据预设与规则生成 ffmpeg 命令
* 监听转码进度并返回给前端
* 处理异常与错误输出

---

### 8.3 前端职责（TS）

* 文件选择 / 拖拽
* 预设选择
* 显示转码进度
* 显示错误信息

---

## 9. 开发阶段规划（Milestones）

### v0.1 — 最小可用版本（MVP）

* 单文件输入
* 固定输出：ProRes 422
* 无 UI 美化
* 可成功导入 PR / AE

### v0.2 — 智能识别

* 自动识别 8-bit / 10-bit
* 自动音频转 PCM

### v0.3 — 多预设支持

* ProRes 422 LT
* DNxHR HQX

### v0.4 — 实用增强

* 批量队列
* 输出文件命名规则
* 基础日志

---

## 10. 成功标准（Success Criteria）

* 输出文件在 PR / AE 中：

  * 可直接导入
  * 时间线拖动流畅
  * 加常规效果不卡顿
* 用户无需理解任何编码参数
* 工具本身稳定、可重复使用

---

## 11. 项目一句话定位

> **这是一个“把 ffmpeg 的专业能力，封装成剪辑友好决策”的桌面工具。**

